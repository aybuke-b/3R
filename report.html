<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>report</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="report_files/libs/clipboard/clipboard.min.js"></script>
<script src="report_files/libs/quarto-html/quarto.js"></script>
<script src="report_files/libs/quarto-html/popper.min.js"></script>
<script src="report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="report_files/libs/quarto-html/anchor.min.js"></script>
<link href="report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="report_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="report_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="section" class="level1">
<h1></h1>
</section>
<section id="section-1" class="level1">
<h1></h1>
</section>
<section id="section-2" class="level1">
<h1></h1>
</section>
<section id="section-3" class="level1">
<h1></h1>
</section>
<section id="section-4" class="level1">
<h1></h1>
</section>
<section id="section-5" class="level1">
<h1></h1>
</section>
<section id="section-6" class="level1">
<h1></h1>
</section>
<section id="section-7" class="level1">
<h1></h1>
</section>
<section id="section-8" class="level1">
<h1></h1>
</section>
<section id="section-9" class="level1">
<h1></h1>
</section>
<section id="section-10" class="level1">
<h1></h1>
</section>
<section id="section-11" class="level1">
<h1></h1>
</section>
<section id="section-12" class="level1">
<h1></h1>
</section>
<section id="section-13" class="level1">
<h1></h1>
</section>
<section id="section-14" class="level1">
<h1></h1>
</section>
<section id="section-15" class="level1">
<h1></h1>
</section>
<section id="section-16" class="level1">
<h1></h1>
</section>
<section id="section-17" class="level1">
<h1></h1>
</section>
<section id="section-18" class="level1">
<h1></h1>
</section>
<section id="section-19" class="level1">
<h1></h1>
</section>
<section id="section-20" class="level1">
<h1></h1>
</section>
<section id="section-21" class="level1">
<h1></h1>
</section>
<section id="section-22" class="level1">
<h1></h1>
</section>
<section id="section-23" class="level1">
<h1></h1>
</section>
<section id="section-24" class="level1">
<h1></h1>
</section>
<section id="section-25" class="level1">
<h1></h1>
</section>
<section id="section-26" class="level1">
<h1></h1>
</section>
<section id="section-27" class="level1">
<h1></h1>
</section>
<section id="section-28" class="level1">
<h1></h1>
</section>
<section id="section-29" class="level1">
<h1></h1>
</section>
<section id="section-30" class="level1">
<h1></h1>
</section>
<section id="section-31" class="level1">
<h1></h1>
</section>
<section id="section-32" class="level1">
<h1></h1>
</section>
<section id="section-33" class="level1">
<h1></h1>
</section>
<section id="section-34" class="level1">
<h1></h1>
</section>
<section id="section-35" class="level1">
<h1></h1>
</section>
<section id="section-36" class="level1">
<h1></h1>
</section>
<section id="section-37" class="level1">
<h1></h1>
</section>
<section id="section-38" class="level1">
<h1></h1>
</section>
<section id="section-39" class="level1">
<h1></h1>
</section>
<section id="section-40" class="level1">
<h1></h1>
<p>#| label: lib_imports library(tidyverse) library(ggridges) library(corrplot) library(glmulti) library(performance) library(stargazer) library(rJava) library(kableExtra) library(patchwork) library(see) library(frontier) library(lmtest) library(dplyr) library(FactoMineR) library(factoextra) # # # #| label: scientific_notation options(scipen = 999) # # # #| label: theme_setting theme_set(theme_minimal()) # Configure le thème ggplot2 globalement # # # #| label: colors darkgray &lt;- “#393E46” highlight &lt;- “#750E21” # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #| label: fig-hedonic #| fig-align: center #| fig-cap: “Plan <span class="math inline">\((z_1, z_2)\)</span> de différents biens avec 2 caractéristiques.”</p>
<p>hedonic_graph_loader &lt;- function() { set.seed(43) num_points &lt;- 6 x &lt;- sample(0:10, num_points, replace = TRUE) y &lt;- sample(0:10, num_points, replace = TRUE) produits &lt;- c(“bien 1”, “bien 2”, “bien 3”, “bien 4”, “bien 5”, “bien 6”)</p>
<pre><code>data &lt;- data.frame(x = x, y = y, produits = factor(produits))

plot &lt;- ggplot(data, aes(x = x, y = y, color = produits)) +
    geom_point(size = 4) +
    labs(
        x = expression(z[1]), y = expression(z[2])
    ) +
    theme(
        legend.title = element_blank(),
        legend.text = element_text(color = darkgray),
    )
return(plot)</code></pre>
<p>} graph &lt;- hedonic_graph_loader() print(graph) # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # root &lt;- getwd() df_path &lt;- file.path(root, “Web_Scraping”, “data”, “df_clean.csv”) df &lt;- read_delim(df_path, delim = “;”) # # # # # # # # # # # # # # # # # # # # # # # mean_price &lt;- round(mean(df<span class="math inline">\(price), 2) min_price &lt;- round(min(df\)</span>price), 2) max_price &lt;- round(max(df<span class="math inline">\(price), 2) median_price &lt;- median(df\)</span>price) var_price &lt;- round(var(df<span class="math inline">\(price), 2) std_price &lt;- round(sd(df\)</span>price), 2) qt_price &lt;- quantile(df$price, probs = seq(0, 1, 0.25)) # # # # # # # # # # # # # # #| fig-align: center #| fig-cap: “Distribution des prix des smartphones.”</p>
<p>df |&gt; ggplot(aes(x = price)) + geom_density(fill = highlight, color = “#e9ecef”, alpha = 0.7) + scale_x_continuous(labels = function(x) paste(x, “€”, sep = ” “)) + geom_vline(aes(xintercept = mean_price), linetype =”dashed”, color = darkgray) + geom_vline(aes(xintercept = median_price), linetype = “dashed”) + geom_label(aes(x = mean_price + 100, y = 0.0002, label = “moyenne”)) + geom_label(aes(x = median_price - 100, y = 0.0001, label = “médiane”)) + labs(x = ““, y =”“) # # # # # # # # # # # min_model &lt;- df |&gt; select(model, price) |&gt; filter(price == min(price)) |&gt; select(model)</p>
<p>max_model &lt;- df |&gt; select(model, price) |&gt; filter(price == max(price)) |&gt; select(model) |&gt; unique() # # # # # # # # # # # # # #| fig-align: center #| fig-cap: “Prix moyen par marque.”</p>
<p>df |&gt; group_by(brand) |&gt; summarise(mean_price = mean(price, na.rm = TRUE)) |&gt; ggplot(aes(x = reorder(brand, -mean_price), y = mean_price)) + geom_bar(stat = “identity”, fill = highlight, alpha = 0.7) + theme(axis.text.x = element_text(angle = 45, hjust = 1)) + scale_y_continuous(labels = function(x) paste(x, “€”, sep = ” “)) + labs(x =”“, y =”“) # # # # # # # # # # # df |&gt; group_by(ram) |&gt; summarise(n = n(), mean_price = round(mean(price), 2)) |&gt; mutate(ram = paste(ram,”Go”), mean_price = paste(mean_price, “€”)) |&gt; kbl(caption = “Prix moyen en fonction de la RAM.”, booktabs = T, col.names = c(“ram”, “<span class="math inline">\(n\)</span>”, “prix moyen <span class="math inline">\(\\bar p\)</span>”), escape = F) |&gt; kable_styling(latex_options = c(“striped”, “hold_position”)) |&gt; row_spec(0, bold = T) # # # df |&gt; group_by(storage) |&gt; summarise(n = n(), mean_price = round(mean(price), 2)) |&gt; mutate(storage = paste(storage, “Go”), mean_price = paste(mean_price, “€”)) |&gt; kbl(caption = “Prix moyen en fonction du stockage.”, booktabs = T, col.names = c(“stockage”, “<span class="math inline">\(n\)</span>”, “prix moyen <span class="math inline">\(\\bar p\)</span>”), escape = F) |&gt; kable_styling(latex_options = c(“striped”, “hold_position”)) |&gt; row_spec(0, bold = T) # # # # # # # #| fig-align: center #| fig-cap: “Ridge plot : Stockage et RAM”</p>
<p>p1 &lt;- df |&gt; ggplot(aes(x = price, y = as.factor(storage), fill = as.factor(storage), alpha = 0.75)) + geom_density_ridges() + theme_ridges() + labs(x = “prix”, y = “stockage”) + scale_y_discrete(labels = function(x) paste(x, “Go”, sep = ” “)) + scale_fill_viridis_d(option =”magma”) + theme(legend.position = “none”)</p>
<p>p2 &lt;- df |&gt; ggplot(aes(x = price, y = as.factor(ram), fill = as.factor(ram), alpha = 0.75)) + geom_density_ridges() + theme_ridges() + labs(x = “prix”, y = “ram”) + scale_y_discrete(labels = function(x) paste(x, “Go”, sep = ” “)) + scale_fill_viridis_d(option =”magma”) + theme(legend.position = “none”)</p>
<p>p1 + p2 # # # # # # # # # #| fig-align: center #| fig-cap: “Proportion des modèles par marque.”</p>
<p>df |&gt; group_by(brand) |&gt; count() |&gt; ggplot(aes(x = reorder(brand, -n), y = n)) + geom_bar(stat = “identity”, fill = highlight, alpha = 0.7) + theme(axis.text.x = element_text(angle = 45, hjust = 1)) + labs(x = ““, y =”“) # # # # # # # #| fig-align: center #| fig-cap:”Nombre de smartphones par lieu de fabrication et par type d’écran.”</p>
<p>p7 &lt;- df |&gt; group_by(made_in) |&gt; count() |&gt; ggplot(aes(x = reorder(made_in, -n), y = n)) + geom_bar(stat = “identity”, fill = highlight, alpha = 0.7) + theme(axis.text.x = element_text(angle = 45, hjust = 1)) + labs(x = ““, y =”“)</p>
<p>p8 &lt;- df |&gt; group_by(screen_type) |&gt; count() |&gt; ggplot(aes(x = reorder(screen_type, -n), y = n)) + geom_bar(stat = “identity”, fill = highlight, alpha = 0.7) + theme(axis.text.x = element_text(angle = 45, hjust = 1)) + labs(x = ““, y =”“)</p>
<p>p7 + p8 # # # # # # # # # # # # # # # # # # # # #| fig-align: center #| fig-cap: “Proportion de modalités des variables dichotomiques.”</p>
<p>p3 &lt;- df |&gt; group_by(induction) |&gt; count() |&gt; ggplot(aes(x = induction, y = n)) + geom_bar(stat = “identity”) + labs(y = ““) + geom_text(aes(label = n), vjust = 1.8, color =”white”, size = 3.5)</p>
<p>p4 &lt;- df |&gt; group_by(fast_charging) |&gt; count() |&gt; ggplot(aes(x = fast_charging, y = n)) + geom_bar(stat = “identity”) + labs(y = ““) + geom_text(aes(label = n), vjust = 1.8, color =”white”, size = 3.5)</p>
<p>p5 &lt;- df |&gt; group_by(upgrade_storage) |&gt; count() |&gt; ggplot(aes(x = upgrade_storage, y = n)) + geom_bar(stat = “identity”) + labs(y = ““) + geom_text(aes(label = n), vjust = 1.8, color =”white”, size = 3.5)</p>
<p>p6 &lt;- df |&gt; group_by(usb_type_c) |&gt; count() |&gt; ggplot(aes(x = usb_type_c, y = n)) + geom_bar(stat = “identity”) + labs(y = ““) + geom_text(aes(label = n), vjust = 1.8, color =”white”, size = 3.5)</p>
<p>(p3 + p4) / (p5 + p6) # # # # # # # # # # # # # # # # # #| fig-cap: “Matrice des corrélations.”</p>
<p>M &lt;- df |&gt; select(where(is.numeric), -c(sensor, random_col, logprice)) |&gt; cor()</p>
<p>corrplot(M, type = “lower”, order = “hclust”, tl.col = “black”, tl.pos = “l”, cl.ratio = 0.2, tl.srt = 45, col = COL1(“Reds”, 200) )</p>
<p>cor_ram &lt;- round(cor(df<span class="math inline">\(price, df\)</span>ram), 2) cor_storage &lt;- round(cor(df<span class="math inline">\(price, df\)</span>storage), 2) cor_height &lt;- round(cor(df<span class="math inline">\(price, df\)</span>height), 3) # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # df_phones &lt;- df |&gt; select(-c(logprice, cpu, model, sensor, screen_tech, stars, reviews, color, cam_1, cam_2, cam_3))</p>
<p>full_model &lt;- lm(price ~ ., data = df_phones) null_model &lt;- lm(price ~ 1, data = df_phones)</p>
<p>backward &lt;- step(full_model, direction = “backward”, scope = list(upper = full_model, lower = null_model) )</p>
<p>forward &lt;- step(null_model, direction = “forward”, scope = list(upper = full_model, lower = null_model) )</p>
<p>genetic_alg &lt;- glmulti(price ~ ., data = df_phones, level = 1, method = “g”, fitfunction = lm, crit = “bic”) # # # genetic &lt;- genetic_alg@objects[[1]]</p>
<p>compare_performance(backward, forward, genetic, metrics = c(“RMSE”, “R2_adj”, “BIC”, “AIC”)) |&gt; kbl(booktabs = TRUE, digits = 2, col.names = c(“Méthode”, “Modèle”, “<span class="math inline">\(AIC\)</span>”, “<span class="math inline">\(AIC_{wt}\)</span>”, “<span class="math inline">\(BIC\)</span>”, “<span class="math inline">\(BIC_{wt}\)</span>”, “<span class="math inline">\(R^2_{adj}\)</span>”, “<span class="math inline">\(RMSE\)</span>”), escape = FALSE, caption = “Comparaison des méthodes de sélection (1).”) |&gt; kable_styling(latex_options = c(“striped”, “hold_position”)) |&gt; row_spec(0, bold = T) # # # # # # # # # # # # # # # # # # # # # # # # # # # # #| fig-align: center #| fig-cap: “Importance des variables.”</p>
<p>plot(genetic_alg, type = “s”, col = highlight, col.main = “white”) abline(v = 0.8, col = “black”) par(cex.axis = 0.8) # # # # # # # res_gen &lt;- summary(genetic_alg) f &lt;- res_gen$bestmodel genreg &lt;- lm(f, data = df_phones)</p>
<p>stargazer( forward, backward, genreg, font.size = “footnotesize”, header = FALSE, title = “Comparaison des méthodes de sélection (2).”, single.row = TRUE, column.labels = c(“forward”, “backward”, “genetic”) ) # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # loghedonic &lt;- lm(log(price) ~ storage + brand + ram + induction + screen_size + made_in + upgrade_storage + das_head + das_limbs + das_chest + fast_charging + network + ppi, data = df_phones )</p>
<p>stargazer(loghedonic, font.size = “footnotesize”, header = FALSE, title = “Modèle de Pricing Hédonique Log-Linéaire”, single.row = TRUE ) # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # pvalue_hyp2 &lt;- t.test(loghedonic<span class="math inline">\(residuals)\)</span>p.value # # # # # # # # # # # # # # # # check_collinearity(loghedonic) |&gt; select(“Term”, “VIF”, “VIF_CI_low”, “VIF_CI_high”, “Tolerance”) |&gt; kbl( booktabs = TRUE, digits = 2, col.names = c(“Variable”, “VIF”, “IC {low}”, “IC {high}”, “Tolérance”), caption = “Vérification de la multicolinéarité.” ) |&gt; kable_styling(latex_options = c(“striped”, “hold_position”)) |&gt; row_spec(0, bold = T) # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #| fig-align: center #| fig-cap: “Homoscédasticité des résidus.” heterosced &lt;- check_heteroscedasticity(loghedonic) plot(heterosced) # # # # # # # # # # # # bp_pvalue &lt;- round(bptest(loghedonic)$p.value, 2) # # # # # # # # # # # #| fig-align: center #| fig-cap: “Normalité des résidus (QQ Plot).” norm &lt;- check_normality(loghedonic) plot(norm, type = “qq”) # # # #| fig-align: center #| fig-cap: “Influence des valeurs extrêmes.” outliers &lt;- check_outliers(loghedonic) plot(outliers, type = “dots”) # # # # # # # # # # # # # check_posterior_predictions(loghedonic) # # # # # # # # # # # # # # # # # # # # # # # # # # # <strong>stars</strong> # <em>p-values</em> to stars. # **<em> # # Description # Fonction permettant d’associer des “<code>***</code>” à des seuils de </em>p-values*. stars &lt;- function(pvalue) { ifelse(pvalue &lt; 0.001, “<em><strong>”, ifelse(pvalue &lt; 0.01, ”</strong>”, ifelse(pvalue &lt; 0.05, ”</em>”, ““) ) ) } # # # scf &lt;- sfa(log(price) ~ storage + brand + ram + induction + screen_size + made_in + upgrade_storage + das_head + das_limbs + fast_charging + das_chest + network + ppi, data = df_phones, truncNorm = FALSE, ineffDecrease = FALSE )</p>
<p>scf_summary &lt;- summary(scf) # # # # # scf_results &lt;- cbind( round(scf_summary<span class="math inline">\(mleParam[, 1], 4),  stars(scf_summary\)</span>mleParam[, 4]), round(scf_summary$mleParam[, 2], 4) )</p>
<p>scf_results |&gt; kbl(booktabs = TRUE, caption = “Résultats de l’estimation du modèle SFA (Cost Frontier).”, col.names = c(“Coefficient”, “Significativité”, “Erreur Std”)) |&gt; kable_styling(latex_options = c(“striped”, “hold_position”)) |&gt; row_spec(0, bold = T) # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #| label: loghedonic_sfa_comp loghedonic_summary &lt;- summary(loghedonic)</p>
<p>loghedonic_results &lt;- cbind( round(loghedonic_summary<span class="math inline">\(coefficients[, 1], 4),  stars(loghedonic_summary\)</span>coefficients[, 4]), round(loghedonic_summary$coefficients[, 2], 4) )</p>
<p>scf_results_2 &lt;- scf_results[1:30, 1:3]</p>
<p>loghedonic_scf_results &lt;- cbind(loghedonic_results, scf_results_2)</p>
<p>loghedonic_scf_results |&gt; kbl(booktabs = TRUE, caption = “Comparaison des coefficients obtenus par les 2 modèles.”, col.names = c(“Coef.”, “Signif.”, “Erreur Std”, “Coef.”, “Signif.”, “Erreur Std”)) |&gt; kable_styling(latex_options = c(“striped”, “hold_position”)) |&gt; add_header_above(c(” “,”Log-Hedonic” = 3, “SFA Cost Frontier” = 3)) |&gt; row_spec(0, bold = T) # # # # # # # mean_eff &lt;- round(mean(efficiencies(scf)), 4) # # # # # # # eff_df &lt;- efficiencies(scf, logDepVar = TRUE) |&gt; as_tibble()</p>
<p>residuals &lt;- residuals(scf, asInData = TRUE) |&gt; as_tibble() |&gt; rename(residuals = value)</p>
<p>predicted &lt;- fitted(scf, asInData = TRUE) |&gt; as_tibble() |&gt; rename(prediction = value)</p>
<p>new_df &lt;- bind_cols(df, eff_df, predicted, residuals)</p>
<p>brand_groups &lt;- new_df |&gt; select(brand, efficiency) |&gt; group_by(brand)</p>
<p>brand_groups |&gt; summarise(mean_eff = round(mean(efficiency), 3), n_count = n()) |&gt; arrange(mean_eff) |&gt; kbl(booktabs = TRUE, caption = “Indice d’efficacité moyen par marque.”, col.names = c(“Marque”, “<span class="math inline">\(\\hat{\\theta_k}\)</span>”, “<span class="math inline">\(n\)</span>”), escape = FALSE) |&gt; kable_styling(latex_options = c(“striped”, “hold_position”)) |&gt; row_spec(0, bold = T) # # # # # # # # # # # # new_df |&gt; select(model, efficiency, ram, storage, price, logprice, prediction) |&gt; arrange(efficiency) |&gt; mutate(price = paste(price, “€”)) |&gt; slice_head(n = 5) |&gt; kbl(booktabs = TRUE, digits = 3, caption = “Les 5 téléphones les moins efficaces.”) |&gt; kable_styling(latex_options = c(“striped”, “hold_position”)) |&gt; row_spec(0, bold = T) # # # # # # # # # new_df |&gt; select(model, efficiency, ram, storage, price, logprice, prediction) |&gt; arrange(efficiency) |&gt; mutate(price = paste(price, “€”)) |&gt; slice_tail(n = 5) |&gt; kbl(booktabs = TRUE, digits = 3, caption = “Les 5 téléphones les plus efficaces.”) |&gt; kable_styling(latex_options = c(“striped”, “hold_position”)) |&gt; row_spec(0, bold = T) # # # # # # # new_df |&gt; select(model, efficiency, ram, storage, price, logprice, prediction) |&gt; distinct() |&gt; arrange(price) |&gt; mutate(price = paste(price, “€”)) |&gt; slice_head(n = 6) |&gt; distinct(model, .keep_all = TRUE) |&gt; kbl(booktabs = TRUE, digits = 3, caption = “Les 5 téléphones les moins chers.”) |&gt; kable_styling(latex_options = c(“striped”, “hold_position”)) |&gt; row_spec(0, bold = T) # # # # # # # new_df |&gt; select(model, efficiency, ram, storage, price, logprice, prediction) |&gt; distinct() |&gt; arrange(price) |&gt; mutate(price = paste(price, “€”)) |&gt; slice_tail(n = 5) |&gt; kbl(booktabs = TRUE, digits = 3, caption = “Les 5 téléphones les plus chers.”) |&gt; kable_styling(latex_options = c(“striped”, “hold_position”)) |&gt; row_spec(0, bold = T) # # # # # # #</p>
<p>variance_plot &lt;- function(pca_results, color) { eigenvalues &lt;- pca_results$eig |&gt; as_tibble() |&gt; rename(var = <code>percentage of variance</code>, cum_var = <code>cumulative percentage of variance</code>)</p>
<pre><code>eigenvalues &lt;- eigenvalues |&gt; mutate(highlight = if_else(row_number() %in% c(1, 2), TRUE, FALSE))

max_variance &lt;- eigenvalues |&gt;
    select(var) |&gt;
    slice(1) |&gt;
    pull()

var_barplot &lt;- eigenvalues |&gt; ggplot(
    aes(
        x = factor(seq_along(var)),
        y = var,
        fill = highlight
    )
) +
    geom_bar(stat = "identity", alpha = 0.7) +
    geom_point(color = "black", size = 2.5) +
    geom_line(aes(group = 1), color = "black", linewidth = 0.75) +
    scale_fill_manual(name = "highlight", values = c("grey50", color)) +
    theme(legend.position = "none") +
    ylim(0, max_variance + 2) +
    labs(x = "Dimensions", y = "Variance cumulée")
return(var_barplot)</code></pre>
<p>}</p>
<p>cor_circle &lt;- function(pca_results) { var_names &lt;- rownames(pca_results<span class="math inline">\(var\)</span>coord) pca_vars &lt;- pca_results<span class="math inline">\(var\)</span>coord |&gt; as_tibble() pca_vars &lt;- pca_vars |&gt; add_column(variable = var_names, .before = “Dim.1”)</p>
<pre><code>theta &lt;- seq(0, 2 * pi, length.out = 100)
x_circle &lt;- cos(theta)
y_circle &lt;- sin(theta)

eigenvalues &lt;- pca_res$eig |&gt;
    as_tibble() |&gt;
    rename(var = `percentage of variance`, cum_var = `cumulative percentage of variance`)
var_1 &lt;- eigenvalues |&gt;
    select(var) |&gt;
    slice(1)
var_2 &lt;- eigenvalues |&gt;
    select(var) |&gt;
    slice(2)

circle &lt;- ggplot() +
    geom_path(aes(x_circle, y_circle), color = "darkgray") +
    geom_hline(yintercept = 0, linetype = "dashed") +
    geom_vline(xintercept = 0, linetype = "dashed") +
    coord_fixed() +
    geom_segment(
        data = pca_vars, aes(
            x = 0, y = 0,
            xend = Dim.1,
            yend = Dim.2
        ),
        arrow = arrow(length = unit(0.1, "inches")),
        color = "black"
    ) +
    geom_text(
        data = pca_vars,
        aes(x = Dim.1, y = Dim.2, label = variable),
        hjust = 0.2, vjust = -1, color = "black"
    ) +
    labs(
        x = glue::glue("Dimension 1 : ({round(var_1,2)} %)"),
        y = glue::glue("Dimension 2 : ({round(var_2,2)} %)")
    )
return(circle)</code></pre>
<p>} # # # pca_df &lt;- new_df |&gt; select(brand, ram, storage, logprice, efficiency, screen_size)</p>
<p>pca_res &lt;- PCA(pca_df, quali.sup = 1, scale.unit = TRUE)</p>
</section>
<section id="storage-brand-ram-induction-screen_size-made_in-upgrade_storage-das_head-das_limbs-fast_charging-das_chest-network-ppi" class="level1">
<h1>storage + brand + ram + induction + screen_size + made_in + upgrade_storage + das_head + das_limbs + fast_charging + das_chest + network + ppi</h1>
<p>mca_df &lt;- new_df |&gt; select(efficiency, logprice, fast_charging, upgrade_storage, induction, network, ram, storage, brand)</p>
<p>mca_df &lt;- mca_df |&gt; mutate(ram = as_factor(ram), storage = as_factor(storage))</p>
<p>mca_res &lt;- MCA(mca_df, quanti.sup = c(1, 2), ncp = 5)</p>
<p>plot(mca_res, label = “all”, graph.type = “ggplot”, choix = “quanti.sup”) # # # #| fig.width: 8 #| fig.height: 3.5 #| fig-align: center #| fig-cap: “Inerties.” variance_plot(mca_res, highlight)</p>
<p>ind_coords &lt;- mca_res<span class="math inline">\(ind\)</span>coord |&gt; as_tibble()</p>
<p>brands &lt;- mca_df |&gt; select(brand)</p>
<p>ind_coords &lt;- bind_cols(brands, ind_coords)</p>
<p>ind_coords |&gt; ggplot() + geom_point(aes(x = <code>Dim 1</code>, y = <code>Dim 2</code>, color = brand))</p>
<p>mca_res<span class="math inline">\(quanti.sup\)</span>coord</p>
<p>mca_res<span class="math inline">\(ind\)</span>contrib</p>
</section>
<section id="section-41" class="level1">
<h1></h1>
</section>
<section id="section-42" class="level1">
<h1></h1>
</section>
<section id="section-43" class="level1">
<h1></h1>
</section>
<section id="section-44" class="level1">
<h1></h1>
</section>
<section id="section-45" class="level1">
<h1></h1>
<p>#| fig.width: 4.5 #| fig.height: 4.5 #| fig-align: center #| fig-cap: “Cercle des corrélations.” cor_circle(pca_res) # # # # # # # # # # # # # # # # # # # prediction &lt;- predict(genreg) # true &lt;- df<span class="math inline">\(price # model &lt;- df\)</span>model # data.frame(true, prediction, model)</p>
</section>
<section id="faire-un-tableau-des-prédictions-les-plus-proches-et-éloignées" class="level1">
<h1>faire un tableau des prédictions les plus proches et éloignées</h1>
</section>
<section id="faire-un-modèle-avec-correction-dhétéroscédasticité.-robuste." class="level1">
<h1>faire un modèle avec correction d’hétéroscédasticité. robuste.</h1>
</section>
<section id="section-46" class="level1">
<h1></h1>
</section>
<section id="section-47" class="level1">
<h1></h1>
</section>
<section id="section-48" class="level1">
<h1></h1>
</section>
<section id="section-49" class="level1">
<h1></h1>
</section>
<section id="section-50" class="level1">
<h1></h1>
</section>
<section id="section-51" class="level1">
<h1></h1>
</section>
<section id="section-52" class="level1">
<h1></h1>
</section>
<section id="section-53" class="level1">
<h1></h1>
</section>
<section id="section-54" class="level1">
<h1></h1>
</section>
<section id="section-55" class="level1">
<h1></h1>
</section>
<section id="section-56" class="level1">
<h1></h1>
</section>
<section id="section-57" class="level1">
<h1></h1>
</section>
<section id="section-58" class="level1">
<h1></h1>
</section>
<section id="section-59" class="level1">
<h1></h1>
</section>
<section id="section-60" class="level1">
<h1></h1>
</section>
<section id="section-61" class="level1">
<h1></h1>
</section>
<section id="section-62" class="level1">
<h1></h1>
</section>
<section id="section-63" class="level1">
<h1></h1>
</section>
<section id="section-64" class="level1">
<h1></h1>
</section>
<section id="section-65" class="level1">
<h1></h1>
</section>
<section id="section-66" class="level1">
<h1></h1>
</section>
<section id="section-67" class="level1">
<h1></h1>
</section>
<section id="section-68" class="level1">
<h1></h1>
</section>
<section id="section-69" class="level1">
<h1></h1>
</section>
<section id="section-70" class="level1">
<h1></h1>
</section>
<section id="section-71" class="level1">
<h1></h1>
</section>
<section id="section-72" class="level1">
<h1></h1>
</section>
<section id="section-73" class="level1">
<h1></h1>
</section>
<section id="section-74" class="level1">
<h1></h1>
</section>
<section id="section-75" class="level1">
<h1></h1>
</section>
<section id="section-76" class="level1">
<h1></h1>
</section>
<section id="section-77" class="level1">
<h1></h1>
</section>
<section id="section-78" class="level1">
<h1></h1>
</section>
<section id="section-79" class="level1">
<h1></h1>
</section>
<section id="section-80" class="level1">
<h1></h1>
</section>
<section id="section-81" class="level1">
<h1></h1>
</section>
<section id="section-82" class="level1">
<h1></h1>
</section>
<section id="section-83" class="level1">
<h1></h1>
</section>
<section id="section-84" class="level1">
<h1></h1>
</section>
<section id="section-85" class="level1">
<h1></h1>
</section>
<section id="section-86" class="level1">
<h1></h1>
</section>
<section id="section-87" class="level1">
<h1></h1>
</section>
<section id="section-88" class="level1">
<h1></h1>
</section>
<section id="section-89" class="level1">
<h1></h1>
</section>
<section id="section-90" class="level1">
<h1></h1>
</section>
<section id="section-91" class="level1">
<h1></h1>
</section>
<section id="section-92" class="level1">
<h1></h1>
</section>
<section id="section-93" class="level1">
<h1></h1>
</section>
<section id="section-94" class="level1">
<h1></h1>
</section>
<section id="section-95" class="level1">
<h1></h1>
</section>
<section id="section-96" class="level1">
<h1></h1>
</section>
<section id="section-97" class="level1">
<h1></h1>
</section>
<section id="section-98" class="level1">
<h1></h1>
</section>
<section id="section-99" class="level1">
<h1></h1>
</section>
<section id="section-100" class="level1">
<h1></h1>
</section>
<section id="section-101" class="level1">
<h1></h1>
</section>
<section id="section-102" class="level1">
<h1></h1>
</section>
<section id="section-103" class="level1">
<h1></h1>
</section>
<section id="section-104" class="level1">
<h1></h1>
</section>
<section id="section-105" class="level1">
<h1></h1>
</section>
<section id="section-106" class="level1">
<h1></h1>
</section>
<section id="section-107" class="level1">
<h1></h1>
</section>
<section id="section-108" class="level1">
<h1></h1>
</section>
<section id="section-109" class="level1">
<h1></h1>
</section>
<section id="section-110" class="level1">
<h1></h1>
</section>
<section id="section-111" class="level1">
<h1></h1>
</section>
<section id="section-112" class="level1">
<h1></h1>
</section>
<section id="section-113" class="level1">
<h1></h1>
</section>
<section id="section-114" class="level1">
<h1></h1>
</section>
<section id="section-115" class="level1">
<h1></h1>
</section>
<section id="section-116" class="level1">
<h1></h1>
</section>
<section id="section-117" class="level1">
<h1></h1>
</section>
<section id="section-118" class="level1">
<h1></h1>
</section>
<section id="section-119" class="level1">
<h1></h1>
</section>
<section id="section-120" class="level1">
<h1></h1>
</section>
<section id="section-121" class="level1">
<h1></h1>
</section>
<section id="section-122" class="level1">
<h1></h1>
</section>
<section id="section-123" class="level1">
<h1></h1>
</section>
<section id="section-124" class="level1">
<h1></h1>
</section>
<section id="section-125" class="level1">
<h1></h1>
</section>
<section id="section-126" class="level1">
<h1></h1>
</section>
<section id="section-127" class="level1">
<h1></h1>
</section>
<section id="section-128" class="level1">
<h1></h1>
</section>
<section id="section-129" class="level1">
<h1></h1>
</section>
<section id="section-130" class="level1">
<h1></h1>
</section>
<section id="section-131" class="level1">
<h1></h1>
</section>
<section id="section-132" class="level1">
<h1></h1>
</section>
<section id="section-133" class="level1">
<h1></h1>
</section>
<section id="section-134" class="level1">
<h1></h1>
</section>
<section id="section-135" class="level1">
<h1></h1>
</section>
<section id="section-136" class="level1">
<h1></h1>
</section>
<section id="section-137" class="level1">
<h1></h1>
</section>
<section id="section-138" class="level1">
<h1></h1>
</section>
<section id="section-139" class="level1">
<h1></h1>
</section>
<section id="section-140" class="level1">
<h1></h1>
</section>
<section id="section-141" class="level1">
<h1></h1>
</section>
<section id="section-142" class="level1">
<h1></h1>
</section>
<section id="section-143" class="level1">
<h1></h1>
</section>
<section id="section-144" class="level1">
<h1></h1>
</section>
<section id="section-145" class="level1">
<h1></h1>
</section>
<section id="section-146" class="level1">
<h1></h1>
</section>
<section id="section-147" class="level1">
<h1></h1>
</section>
<section id="section-148" class="level1">
<h1></h1>
</section>
<section id="section-149" class="level1">
<h1></h1>
</section>
<section id="section-150" class="level1">
<h1></h1>
</section>
<section id="section-151" class="level1">
<h1></h1>
</section>
<section id="section-152" class="level1">
<h1></h1>
</section>
<section id="section-153" class="level1">
<h1></h1>
</section>
<section id="section-154" class="level1">
<h1></h1>
</section>
<section id="section-155" class="level1">
<h1></h1>
</section>
<section id="section-156" class="level1">
<h1></h1>
</section>
<section id="section-157" class="level1">
<h1></h1>
</section>
<section id="section-158" class="level1">
<h1></h1>
</section>
<section id="section-159" class="level1">
<h1></h1>
</section>
<section id="section-160" class="level1">
<h1></h1>
</section>
<section id="section-161" class="level1">
<h1></h1>
</section>
<section id="section-162" class="level1">
<h1></h1>
</section>
<section id="section-163" class="level1">
<h1></h1>
</section>
<section id="section-164" class="level1">
<h1></h1>
</section>
<section id="section-165" class="level1">
<h1></h1>
</section>
<section id="section-166" class="level1">
<h1></h1>
</section>
<section id="section-167" class="level1">
<h1></h1>
</section>
<section id="section-168" class="level1">
<h1></h1>
</section>
<section id="section-169" class="level1">
<h1></h1>
</section>
<section id="section-170" class="level1">
<h1></h1>
</section>
<section id="section-171" class="level1">
<h1></h1>
</section>
<section id="section-172" class="level1">
<h1></h1>
</section>
<section id="section-173" class="level1">
<h1></h1>
</section>
<section id="section-174" class="level1">
<h1></h1>
</section>
<section id="section-175" class="level1">
<h1></h1>
</section>
<section id="section-176" class="level1">
<h1></h1>
</section>
<section id="section-177" class="level1">
<h1></h1>
</section>
<section id="section-178" class="level1">
<h1></h1>
</section>
<section id="section-179" class="level1">
<h1></h1>
</section>
<section id="section-180" class="level1">
<h1></h1>
</section>
<section id="section-181" class="level1">
<h1></h1>
</section>
<section id="section-182" class="level1">
<h1></h1>
</section>
<section id="section-183" class="level1">
<h1></h1>
</section>
<section id="section-184" class="level1">
<h1></h1>
</section>
<section id="section-185" class="level1">
<h1></h1>
</section>
<section id="section-186" class="level1">
<h1></h1>
</section>
<section id="section-187" class="level1">
<h1></h1>
</section>
<section id="section-188" class="level1">
<h1></h1>
</section>
<section id="section-189" class="level1">
<h1></h1>
</section>
<section id="section-190" class="level1">
<h1></h1>
</section>
<section id="section-191" class="level1">
<h1></h1>
</section>
<section id="section-192" class="level1">
<h1></h1>
</section>
<section id="section-193" class="level1">
<h1></h1>
</section>
<section id="section-194" class="level1">
<h1></h1>
</section>
<section id="section-195" class="level1">
<h1></h1>
</section>
<section id="section-196" class="level1">
<h1></h1>
</section>
<section id="section-197" class="level1">
<h1></h1>
</section>
<section id="section-198" class="level1">
<h1></h1>
</section>
<section id="section-199" class="level1">
<h1></h1>
</section>
<section id="section-200" class="level1">
<h1></h1>
</section>
<section id="section-201" class="level1">
<h1></h1>
</section>
<section id="section-202" class="level1">
<h1></h1>
</section>
<section id="section-203" class="level1">
<h1></h1>
</section>
<section id="section-204" class="level1">
<h1></h1>
</section>
<section id="section-205" class="level1">
<h1></h1>
</section>
<section id="section-206" class="level1">
<h1></h1>
</section>
<section id="section-207" class="level1">
<h1></h1>
</section>
<section id="section-208" class="level1">
<h1></h1>
</section>
<section id="section-209" class="level1">
<h1></h1>
</section>
<section id="section-210" class="level1">
<h1></h1>
</section>
<section id="section-211" class="level1">
<h1></h1>
</section>
<section id="section-212" class="level1">
<h1></h1>
</section>
<section id="section-213" class="level1">
<h1></h1>
</section>
<section id="section-214" class="level1">
<h1></h1>
</section>
<section id="section-215" class="level1">
<h1></h1>
</section>
<section id="section-216" class="level1">
<h1></h1>
</section>
<section id="section-217" class="level1">
<h1></h1>
</section>
<section id="section-218" class="level1">
<h1></h1>
</section>
<section id="section-219" class="level1">
<h1></h1>
</section>
<section id="section-220" class="level1">
<h1></h1>
</section>
<section id="section-221" class="level1">
<h1></h1>
</section>
<section id="section-222" class="level1">
<h1></h1>
</section>
<section id="section-223" class="level1">
<h1></h1>
</section>
<section id="section-224" class="level1">
<h1></h1>
</section>
<section id="section-225" class="level1">
<h1></h1>
</section>
<section id="section-226" class="level1">
<h1></h1>
</section>
<section id="section-227" class="level1">
<h1></h1>
</section>
<section id="section-228" class="level1">
<h1></h1>
</section>
<section id="section-229" class="level1">
<h1></h1>
</section>
<section id="section-230" class="level1">
<h1></h1>
</section>
<section id="section-231" class="level1">
<h1></h1>
</section>
<section id="section-232" class="level1">
<h1></h1>
</section>
<section id="section-233" class="level1">
<h1></h1>
</section>
<section id="section-234" class="level1">
<h1></h1>
</section>
<section id="section-235" class="level1">
<h1></h1>
</section>
<section id="section-236" class="level1">
<h1></h1>
</section>
<section id="section-237" class="level1">
<h1></h1>
</section>
<section id="section-238" class="level1">
<h1></h1>
</section>
<section id="section-239" class="level1">
<h1></h1>
</section>
<section id="section-240" class="level1">
<h1></h1>
</section>
<section id="section-241" class="level1">
<h1></h1>
</section>
<section id="section-242" class="level1">
<h1></h1>
</section>
<section id="section-243" class="level1">
<h1></h1>
</section>
<section id="section-244" class="level1">
<h1></h1>
</section>
<section id="section-245" class="level1">
<h1></h1>
</section>
<section id="section-246" class="level1">
<h1></h1>
</section>
<section id="section-247" class="level1">
<h1></h1>
</section>
<section id="section-248" class="level1">
<h1></h1>
</section>
<section id="section-249" class="level1">
<h1></h1>
</section>
<section id="section-250" class="level1">
<h1></h1>
</section>
<section id="section-251" class="level1">
<h1></h1>
</section>
<section id="section-252" class="level1">
<h1></h1>
</section>
<section id="section-253" class="level1">
<h1></h1>
</section>
<section id="section-254" class="level1">
<h1></h1>
</section>
<section id="section-255" class="level1">
<h1></h1>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>