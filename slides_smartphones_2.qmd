---
title: "Application des mod√®les SFA √† l'√©tude des prix"
subtitle: "<script>const currentDT = new Date().toLocaleDateString();document.write(currentDT);</script>"
author: "`Aybuk√© BICAT` & `Corentin DUCLOUX`"
institute: <img src = https://corentinducloux.fr/Reveal.js/univ-tours.png width="70%">
title-slide-attributes:
    data-notes: "Bonjour √† tous, on va vous pr√©senter la deuxi√®me partie de notre projet 3R portant sur l'application des mod√®les SFA √† l'√©tude des prix. Avant de rappeler les fondements th√©oriques des mod√®les SFA ainsi que les r√©sultats de l'estimation, on va revenir sur notre probl√©matique appliqu√©e."
format: 
  revealjs:
    slide-number: true
    mermaid-format: svg
    chalkboard: true
    transition: slide
    background-transition: fade
    theme: blood
    incremental: true   
    footer: "--- Recherche, R√©alisation, Restitution ---"
    logo: https://corentinducloux.fr/dossier_img/mecen_transparent.png
    controls : true
    preview-links: auto
    view-distance: 20
    reference-location: document
    bibliography: references.bib
    include-in-header:
        - text: |
            <style>
            #title-slide .title {
            font-size: 1.75em;
            }
            </style>
link-external-icon: true
engine: knitr
---

```{r}
#| label: lib_imports
library(gt)
library(arrow)
library(tidyverse)
library(frontier)
```

```{r}
#| label: theming
#| echo: false
theme_set(theme_minimal())
thematic::thematic_on(bg = "#222222", fg = "white", accent = "purple", font = "PT Sans")
```

```{r}
#| label: custom_funcs
makestars <- function(pvalues) {
    return(
        dplyr::case_when(
            pvalues < 0.001 ~ "_***_",
            pvalues < 0.05 ~ "_***_",
            pvalues < 0.1 ~ "_***_",
            .default = ""
        )
    )
}

`%nin%` <- negate(`%in%`)
```

## Probl√©matique {background-color="black" background-image="https://vivreaulycee.fr/wp-content/uploads/2018/12/question-mark-2492009_1280-1200x480.jpg" background-size="cover" background-opacity="0.75"}

`Combinaison d'un mod√®le SFA et d'une r√©gression h√©donique pour √©valuer la discordance entre les prix de smartphones et leur valeur intrins√®que.`

::: {.footer}
--- Recherche, `R√©alisation`, Restitution ---
:::

::: {.notes}
*Aybuk√©*

Notre probl√©matique √©tait la suivante : *Voir slide*

En se basant sur cette probl√©matique, nous voulions, en plus d'une estimation √©conom√©trique qui pr√©sente son lot de complexit√© (nous le verrons par la suite), cr√©er une application, et plus pr√©cis√©ment un comparateur d'efficacit√©.

En premier lieu, il convient de se poser une question qui semble √©vidente √† premi√®re vue, mais qui, quand on s'y penche de plus pr√®s, est assez sophistiqu√©e. 

- Cette question c'est "Qu'est ce qu'un comparateur exactement ?"
:::

## Comparateur {.smaller}

> *Un comparateur en ligne, qu'est ce que c'est ?*


::: {.callout-tip}

## D√©finition

Un comparateur est un site web qui permet de comparer diff√©rents produits ou services.

Principalement ax√© sur les prix, il peut √©galement prendre en compte les aspects techniques et la qualit√© des produits.

- <https://www.idealo.fr>
- <https://www.ledenicheur.fr>
- <https://www.kimovil.com/fr/>

:::

:::{.notes}

Les exemples sont multiples : Comparateur de vols, d'assurances, de voitures, de banques...

En bref il existe une vari√©t√© de cas d'usage et un nombre croissant d'utilisateurs faisant appel √† ces comparateurs avant d'acheter un bien ou un service.

On a aussi mis √† disposition des exemples de comparateurs sur nos slides. 

Les deux premiers sont des r√©f√©rences dans le domaine des comparateurs de prix g√©n√©ralistes.

Le troisi√®me, `kimovil` est sp√©cialis√© dans l'analyse des smartphones et est assez analogue √† ce que nous allons proposer puisqu'il n'est pas uniquement un comparateur de prix mais qu'il inclut une dimension de mod√©lisation, plus pr√©cis√©ment un score qui est d√©termin√© gr√¢ce √† du **Machine Learning**.

Cela √©tant, la description du score est assez sommaire, il est simplement pr√©cis√© que plus de 200 variables sont utilis√©es... 

$\Rightarrow$ Finalement ce score est plut√¥t opaque.

Questions juridiques / √©conomiques / statistiques / algorithmiques.

:::

## Obligations d'information sur les comparateurs {.smaller}

Les op√©rateurs de plateforme en ligne doivent d√©livrer au consommateur une information **loyale**, **claire** et **transparente**, selon l‚Äôarticle [L. 111-7 du code de la consommation](https://www.legifrance.gouv.fr/codes/article_lc/LEGIARTI000033219601).

Les comparateurs en ligne sont donc eux aussi soumis √† ces obligations de loyaut√© et de transparence.

- Page d√©di√©e accessible depuis toutes les autres pages du comparateur informant le fonctionnement de celui-ci.

- Faire figurer sur chaque page de r√©sultats  les informations concernant les crit√®res de classement.

- Indiquer via la mention explicite **¬´ annonce ¬ª** les r√©sultats li√©s √† des partenariats r√©mun√©r√©s.

:::{.notes}

Il va sans dire que tr√®s peu de comparateurs respectent le premier point, souvent pour une raison simple : ce sont juste des listings de prix de t√©l√©phones du moins cher au plus cher, il n'y a pas vraiment de fonctionnement √† proprement parler.

De m√™me, concernant les crit√®res de classement.

En revanche le troisi√®me point est presque toujours indiqu√© quelque part avec la mention *publicit√©* ou *annonce* quand il y a un partenariat r√©mun√©r√©, et c'est normal car une grande partie des revenus de ces comparateurs provient de ces partenariats donc il font assez attention √† ce point.

***

L'avantage de notre comparateur c'est qu'il respecte les deux premiers points, sans se soucier du troisi√®me puisqu'on a pas de partenariats r√©mun√©r√©s. Tout √ßa permet d'offrir une grande transparence pour le consommateur.

:::

## `SMART'SPECS` D√©monstration

**üöÄ Lancement de l'application**

::: {.callout-note}

## Depuis le terminal

*Lancement du shell poetry* :

```powershell
py -m poetry shell
```

*Lancement de l'application* :

```powershell
python -m streamlit run Accueil.py
```

$\Rightarrow$ *Simple* : seulement 2 commandes pour acc√©der √† l'application !

:::

<img src = imgs/logo.png width="10%">



:::{.notes}

1. **Page d'accueil**

Quand on lance l'application, on arrive donc sur une page d'accueil soign√©e pour expliquer l'utilit√© de notre comparateur Smart Specs, permettant de vous assister dans la qu√™te de votre smartphone id√©al. 

Il est pr√©cis√© pour l'utilisateur qu'un mod√®le SFA est utilis√© en arri√®re-plan mais on vous rappelera plus en d√©tail le fonctionnement du mod√®le SFA quand on arrivera √† la partie des r√©sultats.

On peut aussi voir la derni√®re d'actualisation du scraping. Par rapport √† la premi√®re pr√©sentation, ce sont donc des donn√©es plus r√©centes, issues de f√©vrier.

On peut ensuite s'int√©resser √† plusieurs autres pages.

2. **Insights**

Les insights sont simplement des statistiques descriptives qui nous permettent de mettre en avant des r√©sultats pas forc√©ment observables dans l'achat d'un t√©l√©phone.

On peut par exemple s'int√©resser au prix moyen par marque. On retrouve, sans surprise, comme dans la premi√®re pr√©sentation, que XIAOMI propose les t√©l√©phones les moins chers en moyenne tandis qu'APPLE propose les t√©l√©phones les plus chers en moyenne.

Pour le nombre de mod√®les vendus par marque, on retrouve XIAOMI, SAMSUNG & APPLE sur le podium et qui poss√®dent √† eux trois plus de 300 t√©l√©phones commercialis√©s soit 80% du total sur Boulanger.

Pour ce qui est du prix en fonction de la RAM, on peut voir que le prix m√©dian augmente avec la RAM, ce qui est plut√¥t logique. On voit aussi gr√¢ce au jitterplot √† c√¥t√© du boxplot que la dispersion augmente √† mesure que la RAM augmente.

On peut faire les m√™mes interpr√©tations pour le boxplot du prix en fonction du stockage mais on remarque qu'il y a un peu moins de dispersion.

Enfin, il y a aussi la distribution des prix, qu'on vous avait expos√© dans la premi√®re pr√©sentation et qui, on le rappelle, poss√©dait une distribution asym√©trique. C'est toujours le cas, et on remarque de mani√®re plus importante encore deux pics dans la distribution des prix, qui nous permettent de distinguer des t√©l√©phones **bas de gamme** et **haut de gamme**.

L'option distribution marginale permet de visualiser la distribution des t√©l√©phones sans aggr√©gation par intervalle de prix, c'est √† dire qu'on est en mesure de voir pour chaque mod√®le le prix exact.

Enfin, l'option la plus int√©ressante selon nous est la distribution par marque, qui permet de subdiviser la distribution g√©n√©rale par marque.

Ce qui pourrait √™tre int√©ressant serait de s√©lectionner les marques qui nous int√©ressent : par exemple XIAOMI et APPLE, et on remarque que XIAOMI est sur une gamme de prix bas tandis que pour APPLE la gamme de prix est plus √©tal√©e. On voit globalement que ces deux marques ne sont pas sur le m√™me march√©.

3. **Efficacit√©**

Apr√®s avoir pris connaissance de ces insights, l'utilisateur peut naviguer sur la page d'analyse de l'efficacit√© calcul√©e par le mod√®le SFA, qui est le point central de notre application.

Initialement, pour une question de lisibilit√© les deux seules marques s√©lectionn√©es sont APPLE & SAMSUNG, mais on peut choisir plus de marques si on le souhaite. De m√™me, le prix maximal d'un smartphone est fix√© √† 500 ‚Ç¨, que l'utilisateur pourra ensuite modifier √† sa guise.

On voit ensuite deux indicateurs : le nombre de t√©l√©phones efficaces et inefficaces. Ces indicateurs proviennent du nuage de points des efficacit√©s en fonction du prix qu'on peut voir ici. Tous les t√©l√©phones compris dans la zone rouge sont consid√©r√©s comme *inefficaces*, c'est √† dire que ce sont de mauvais rapports qualit√©-prix alors que ceux qui sont au-dessus sont de bons rapport qualit√©-prix. A noter que ce seuil peut √™tre aussi modifi√© par l'utilisateur si il veut plus de contr√¥le.

En plus de tout √ßa, l'utilisateur dispose aussi d'un diagramme en barres dynamique de l'efficacit√© moyenne par marque.

4. **Comparateur**

L'id√©e est ensuite de s'appuyer sur la page d'analyse de l'efficacit√© pour comparer deux t√©l√©phones √† prix similaires mais √† efficacit√© diff√©rente. La page Comparateur permet pr√©cis√©ment de faire √ßa.

Ce comparateur est plus complet que ceux actuellement existants parce qu'il inclue √©videmment l'efficacit√© mais aussi un syst√®me permettant de comparer les caract√©ristiques comme la RAM, le stockage, etc.

$\Rightarrow$ On peut par exemple choisir l'**iPhone 14 plus** (256 Go) et le **Google Pixel 8 Pro** (128 Go) qui ont des prix similaires mais des efficacit√©s l√©g√®rement diff√©rentes.

5. **D√©tails**

Cet onglet permet de visualiser tous les mod√®les disponibles et leurs caract√©ristiques, ou alors de filtrer l'ensemble des t√©l√©phones disponibles selon la marque, la capacit√© de stockage et la RAM. Dans le tableau on peut filtrer selon chaque variable disponible.

:::

## Hedonic Pricing : aspect th√©orique (I)

Cadre apport√© par @rosen1974. On √©tudie un bien diff√©renci√© $z$ d√©crit par le vecteur de ses $n$ caract√©ristiques mesurables tel que : 

:::{.fragment .fade-in}
$$z = (z_1, z_2, \dots, z_n)$$ 
:::

:::{.fragment .fade-in}
> *La diff√©renciation horizontale et verticale des produits implique qu'une vaste gamme de paniers est disponible.*
:::

::: {.footer}
--- `Recherche`, R√©alisation, Restitution ---
:::

::: {.notes}

Avant de rentrer dans la partie des estimations √©conom√©triques, on va vous faire quelques rapides rappels de notre partie de recherche pour vous rafra√Æchir la m√©moire.

Contrairement √† Lancaster que nous n'avons pas rementionn√© qui √©tudie uniquement le c√¥t√© consommateur, Rosen s'int√©resse √†
**l‚Äô√©quilibre de march√© de biens diff√©renci√©s** : 

- avec un continuum de biens du c√¥t√© de l‚Äôoffre
- et un continuum de consommateurs h√©t√©rog√®nes du c√¥t√© de la demande

**Diff√©renciation Horizontale** $\Rightarrow$ A prix donn√©, il n'y a pas unanimit√© dans le choix des consommateurs entre 2 biens (jaune et rouge) : ce sont des diff√©rences de go√ªts.

**Diff√©renciation Verticale** $\Rightarrow$ A prix donn√©, il y a unanimit√© dans le choix des consommateurs entre 2 voitures biens : l'un est meilleur que l'autre.
:::

## Hedonic Pricing : aspect th√©orique (III)

- Le consommateur n'ach√®te qu'**une seule** unit√© de bien qui est une combinaison d'attributs $z_1, z_2, \dots, z_n$.
- Un prix est donc d√©fini en chaque point du plan et guide les choix de localisation des consommateurs et des producteurs concernant les ensembles de caract√©ristiques achet√©s et vendus.

:::{.fragment .fade-in}
$$\boxed{p(z) = p(z_1, z_2, \dots, z_n)}$$
:::

::: {.footer}
--- `Recherche`, R√©alisation, Restitution ---
:::

:::{.notes}
*Corentin*

Achat d'une seule unit√© de bien car historiquement, Rosen s'int√©resse principalement aux biens durables (Machine √† laver, logements, voitures, smartphones...). Pourquoi ? C'est parce que c'est beaucoup plus simple d'obtenir des caract√©ristiques observables sur ces biens durables que sur des biens consommables.

On aboutit √† une relation fonctionnelle entre les caract√©ristiques des biens
et leur prix, appel√©e fonction de prix h√©donique $p(z)$.

***

Il n'en reste pas moins qu'il subsiste un probl√®me ind√©niable : Ce qu'on aimerait r√©ellement mesurer c'est le **service rendu par un produit** et non pas les caract√©ristiques de ce produit, et √ßa c'est compl√®tement inobservable. Donc en bref il va falloir faire attention pour interpr√©ter correctement les r√©sultats des r√©gressions.
:::

## OLS LEVEL-LEVEL (I) {.smaller}

$$
\begin{split}
price_i = \beta_0 + \beta_1 storage_i + \beta_2 brand_i + \beta_3 ram_i\\
+ \beta_4 induction_i + \beta_5 screen\_size_i + \beta_6 screen\_type_i\\
+ \beta_7 made\_in_i + \beta_8 upgrade\_storage_i + \beta_{9} das\_limbs_i \\
+ \beta_{10} network_i + \beta_{11} ppi_i + \epsilon_i
\end{split}
$$

:::{.notes}

Ici on retrouve le mod√®le en niveau dont les variables n'ont pas √©t√© choisies au hasard mais qui ont fait l'objet d'une s√©lection de variables gr√¢ce √† un algorithme g√©n√©tique, on l'avait expliqu√© mais on ne va pas re-rentrer dans les d√©tails. L'int√©r√™t de ce mod√®le en niveau c'est de pouvoir directement interpr√©ter les coefficients comme des prix (effets marginaux). 

:::

## OLS LEVEL-LEVEL (II) {.smaller}

```{r}
df_phones <- read_delim("Web_Scraping/data/df_clean_2.csv", delim = ";")

levelhedonic <- lm(
    price ~ storage + brand + ram + induction + screen_size + screen_type + made_in + upgrade_storage + das_limbs + network + ppi,
    data = df_phones
)

r_squared_level <- round(summary(levelhedonic)$r.squared, 3)

r_adj_squared_level <- round(summary(levelhedonic)$adj.r.squared, 3)

summary(levelhedonic)$coefficients |>
    as.data.frame() |>
    rownames_to_column(var = "Variables") |>
    as_tibble() |>
    janitor::clean_names() |>
    mutate(
        variables = case_when(
            variables == "brandGOOGLE" ~ "*brand* `(GOOGLE)`",
            variables == "brandHONOR" ~ "*brand* `(HONOR)`",
            variables == "brandMOTOROLA" ~ "*brand* `(MOTOROLA)`",
            variables == "brandOPPO" ~ "*brand* `(OPPO)`",
            variables == "brandSAMSUNG" ~ "*brand* `(SAMSUNG)`",
            variables == "brandSONY" ~ "*brand* `(SONY)`",
            variables == "brandXIAOMI" ~ "*brand* `(XIAOMI)`",
            variables == "inductionTRUE" ~ "*induction* `(True)`",
            variables == "screen_typeBords incurv√©s" ~ "*screen_type* `(Bords Incurv√©s)`",
            variables == "screen_typePlat" ~ "*screen_type* `(Plat)`",
            variables == "screen_typePliable" ~ "*screen_type* `(Pliable)`",
            variables == "made_inJapon" ~ "*made_in* `(Japon)`",
            variables == "made_inTha√Ølande" ~ "*made_in* `(Tha√Ølande)`",
            variables == "made_inVi√™t Nam" ~ "*made_in* `(Vi√™t Nam)`",
            variables == "upgrade_storageTRUE" ~ "*upgrade_storage* `(True)`",
            variables == "network5G" ~ "*network* `(5G)`",
            .default = as.character(glue::glue("*{variables}*"))
        )
    ) |>
    mutate(signif = makestars(pr_t)) |>
    gt() |>
    cols_hide(c(t_value, pr_t)) |>
    cols_label(
        variables = gt::md("**Variables**"),
        estimate = gt::md("**Coefficients**"),
        std_error = gt::md("**Ecart Type**"),
        signif = gt::md("**Significativit√©**")
    ) |>
    tab_header(
        title = md("R√©sultats de l'estimation pour le mod√®le  de pricing **H√©donique**"),
        subtitle = md("*Variable d√©pendante* : `price`")
    ) |>
    fmt_number(
        columns = c(std_error, pr_t),
        decimals = 2,
        drop_trailing_zeros = TRUE
    ) |>
    data_color(
        columns = estimate,
        rows = estimate < 0,
        method = "numeric",
        palette = c("red", "orange"),
        apply_to = "text"
    ) |>
    data_color(
        columns = estimate,
        rows = estimate > 0,
        method = "numeric",
        palette = c("lightgreen", "darkgreen"),
        apply_to = "text"
    ) |>
    fmt_currency(
        columns = c(estimate),
        currency = "euro",
        placement = "right",
        incl_space = TRUE
    ) |>
    fmt_markdown(c(variables, signif)) |>
    tab_footnote(
        md(glue::glue("$R^2=$ {r_squared_level}"))
    ) |>
    tab_footnote(
        md(glue::glue("| $R^2_{{adj}}=$ {r_adj_squared_level}"))
    ) |>
    tab_options(
        table.background.color = "#222222",
        table.font.color = "white",
        table.font.size = 8,
    ) |>
    opt_interactive(page_size_default = 5, use_highlight = TRUE)
```

:::{.notes}

Ici le coefficient $\beta_1$ s‚Äôinterpr√®te comme l‚Äôeffet marginal d‚Äô1 Go suppl√©mentaire
de capacit√© de stockage sur le prix, c'est √† dire que si la capacit√© de stockage augmente de 1 Go, alors, le prix augmente de 91 centimes, cet.par.

‚Ä¢ En ayant comme cat√©gorie de r√©f√©rence Apple pour la variable marque (brand), on peut
voir que toutes les marques ont un impact n√©gatif sur le prix, cet. par.
‚Äì La marque la plus valoris√©e derri√®re Apple est **SONY** avec 313.59 ‚Ç¨ de diff√©rence
par rapport √† **APPLE**.
‚Äì La marque la moins valoris√©e est **XIAOMI** avec 588.81 ‚Ç¨ de diff√©rence par rapport
√† **APPLE**.

- Une augmentation d‚Äô1 Go de ram augmente le prix de 27.58 ‚Ç¨, cet. par. (Faire lien avec graph insight)

Pour le type d‚Äô√©cran (screen_type), la cat√©gorie de r√©f√©rence est borderless (un √©cran sans
bordure).

‚Äì Disposer d‚Äôun √©cran √† bord incurv√© diminue le prix de 228.44 ‚Ç¨ par rapport √† la
cat√©gorie de r√©f√©rence, cet. par.
‚Äì Pour l‚Äô√©cran plat, le prix diminue de 89.78 ‚Ç¨ par rapport √† la cat√©gorie de r√©f√©-
rence, cet. par.
‚Äì Avoir un √©cran pliable fait augmenter le prix de 172.6 ‚Ç¨ par rapport √† la cat√©gorie
de r√©f√©rence, cet. par.
:::

## OLS LEVEL-LEVEL (III)

```{r}
performance::check_posterior_predictions(levelhedonic)
```

:::{.notes}
Aussi, une √©tape visuelle qu'on peut mettre en place est de v√©rifier l‚Äôajustement du
mod√®le. La v√©rification pr√©dictive a posteriori permet de simuler des donn√©es r√©pliqu√©es
avec le mod√®le ajust√© puis les comparer aux donn√©es observ√©es.

$\Rightarrow$ L‚Äôobjectif est de d√©tecter si le mod√®le est inad√©quat pour d√©crire les donn√©es.

Note : Pour cela, on utilise d'abord les donn√©es observ√©es et les pr√©dicteurs pour mettre √† jour notre compr√©hension des param√®tres inconnus du mod√®le. Ensuite, √† partir de cette mise √† jour, on g√©n√®re plusieurs ensembles de r√©sultats possibles en faisant varier ces param√®tres, c'est du bootstrap. Ces simulations aident ensuite √† √©valuer la perf du mod√®le.

Ici on retrouve bien en vert la distribution bimodale des prix qu'on avait vu dans notre application, mais par contre le mod√®le a du mal √† la repr√©senter, surtout pour les t√©l√©phones entre 200 et 500 ‚Ç¨.
:::

## OLS LOG-LEVEL (I) {.smaller}

$$
\begin{split}
\ln(price_i) = \beta_0 + \beta_1 storage_i + \beta_2 brand_i + \beta_3 ram_i\\
+ \beta_4 induction_i + \beta_5 screen\_size_i + \beta_6 screen\_type_i\\
+ \beta_7 made\_in_i + \beta_8 upgrade\_storage_i + \beta_{9} das\_limbs_i \\
+ \beta_{10} network_i + \beta_{11} ppi_i + \epsilon_i
\end{split}
$$

## OLS LOG-LEVEL (II) {.smaller}

```{r}
loghedonic <- lm(
    logprice ~ storage + brand + ram + induction + screen_size + screen_type + made_in + upgrade_storage + das_limbs + network + ppi,
    data = df_phones
)

r_squared_log <- round(summary(loghedonic)$r.squared, 3)

r_adj_squared_log <- round(summary(loghedonic)$adj.r.squared, 3)

summary(loghedonic)$coefficients |>
    as.data.frame() |>
    rownames_to_column(var = "Variables") |>
    as_tibble() |>
    janitor::clean_names() |>
    mutate(
        variables = case_when(
            variables == "brandGOOGLE" ~ "*brand* `(GOOGLE)`",
            variables == "brandHONOR" ~ "*brand* `(HONOR)`",
            variables == "brandMOTOROLA" ~ "*brand* `(MOTOROLA)`",
            variables == "brandOPPO" ~ "*brand* `(OPPO)`",
            variables == "brandSAMSUNG" ~ "*brand* `(SAMSUNG)`",
            variables == "brandSONY" ~ "*brand* `(SONY)`",
            variables == "brandXIAOMI" ~ "*brand* `(XIAOMI)`",
            variables == "inductionTRUE" ~ "*induction* `(True)`",
            variables == "screen_typeBords incurv√©s" ~ "*screen_type* `(Bords Incurv√©s)`",
            variables == "screen_typePlat" ~ "*screen_type* `(Plat)`",
            variables == "screen_typePliable" ~ "*screen_type* `(Pliable)`",
            variables == "made_inJapon" ~ "*made_in* `(Japon)`",
            variables == "made_inTha√Ølande" ~ "*made_in* `(Tha√Ølande)`",
            variables == "made_inVi√™t Nam" ~ "*made_in* `(Vi√™t Nam)`",
            variables == "upgrade_storageTRUE" ~ "*upgrade_storage* `(True)`",
            variables == "network5G" ~ "*network* `(5G)`",
            .default = as.character(glue::glue("*{variables}*"))
        )
    ) |>
    mutate(signif = makestars(pr_t)) |>
    gt() |>
    cols_hide(c(t_value, pr_t)) |>
    cols_label(
        variables = gt::md("**Variables**"),
        estimate = gt::md("**Coefficients**"),
        std_error = gt::md("**Ecart Type**"),
        signif = gt::md("**Significativit√©**")
    ) |>
    tab_header(
        title = md("R√©sultats de l'estimation pour le mod√®le  de pricing **H√©donique**"),
        subtitle = md("*Variable d√©pendante* : `log(price)`")
    ) |>
    fmt_number(
        columns = c(estimate, std_error, pr_t),
        decimals = 2,
        drop_trailing_zeros = TRUE,
    ) |>
    fmt_percent(
        columns = estimate,
        rows = between(estimate, 0, 4),
        pattern = "+{x}"
    ) |>
    fmt_percent(
        columns = estimate,
        rows = estimate < 0,
    ) |>
    data_color(
        columns = estimate,
        rows = variables != "(Intercept)",
        method = "numeric",
        palette = c("red", "orange"),
        apply_to = "text"
    ) |>
    data_color(
        columns = estimate,
        rows = estimate > 0,
        method = "numeric",
        palette = c("lightgreen", "darkgreen"),
        apply_to = "text"
    ) |>
    fmt_markdown(c(signif, variables)) |>
    tab_footnote(
        md(glue::glue("$R^2=$ {r_squared_log}"))
    ) |>
    tab_footnote(
        md(glue::glue("| $R^2_{{adj}}=$ {r_adj_squared_log}"))
    ) |>
    tab_options(
        table.background.color = "#222222",
        table.font.color = "white"
    ) |>
    opt_interactive(page_size_default = 5, use_highlight = TRUE)
```

:::{.notes}

Ici le coefficient $\beta_1$ s‚Äôinterpr√®te comme le changement en pourcentage du prix lorsque
la capacit√© de stockage augmente d‚Äô1 Go, c'est √† dire que si la capacit√© de stockage augmente de 1 Go, alors, le prix augmente de 0.06%, cet.par.

- En ayant comme cat√©gorie de r√©f√©rence Apple pour la variable marque (brand), on peut
voir que toutes les marques ont un impact n√©gatif sur le prix, cet. par.

‚Äì La marque la plus valoris√©e derri√®re Apple est SAMSUNG avec une diff√©rence de prix
de 39.53%.
‚Äì La marque la moins valoris√©e est XIAOMI avec une diff√©rence de prix de 101.06% par
rapport √† Apple.

- Si la ram augmente de 1 Go, alors le prix augmente de 7.8%, cet. par

‚Äì Disposer d‚Äôun √©cran √† bord incurv√© diminue le prix de 9.97% par rapport √† la
cat√©gorie de r√©f√©rence, cet. par.
‚Äì Pour l‚Äô√©cran plat, le prix diminue de 2.8% par rapport √† la cat√©gorie de r√©f√©-
rence, cet. par.
‚Äì Avoir un √©cran pliable fait augmenter le prix de 39.13% par rapport √† la cat√©gorie
de r√©f√©rence, cet. par.
:::

## OLS LOG-LEVEL (III)

```{r}
performance::check_posterior_predictions(loghedonic)
```

:::{.notes}
Ici on voit que m√™me si le mod√®le a du mal √† pr√©dire une certaine portion de la distribution, il s'en sort tr√®s bien sur les extr√©mit√©s et globalement l'ad√©quation du mod√®le semble meilleure.
:::

## SFA ~ RAPPELS (I) {.smaller}

@aigner1977 :

**Objectif** : Formulation et estimation de fonctions de fronti√®re de production stochastique.

:::{.fragment .fade-in}
$${\displaystyle y_{i}=f(x_{i};\beta )\cdot TE_{i}}$$
:::

- $TE_i$ repr√©sente l'efficacit√© technique, d√©finie comme le ratio d'output observ√© sur l'output maximum r√©alisable, c'est √† dire : $TE_i = \dfrac{y_i}{y_i^*}$.

- Ajout d'un composant **stochastique** ${\exp \left\{{v_{i}}\right\}}$ qui repr√©sente les chocs al√©atoires affectant la production. La fonction de production devient alors :

:::{.fragment .fade-in}
$$\boxed{{\displaystyle y_{i}=f(x_{i};\beta )\cdot TE_{i}\cdot \exp \left\{{v_{i}}\right\}}}$$

:::

::: {.footer}
--- `Recherche`, R√©alisation, Restitution ---
:::

:::{.notes}
*Aybuk√©*

On vous a pr√©sent√© deux mod√®les qui appliquent le concept du pricing h√©donique mais qui finalement restent des r√©gressions lin√©aires classiques. Avant de vous pr√©senter les r√©sultats de l'estimation du mod√®le SFA, on va vous r√©-√©xpliquer rapidement le fct th√©orique.

- On repart d'une fonction de production classique, mais on lui ajoute un terme multiplicatif $TE_i$.

- Si $TE_i = 1$ alors la firme $i$ produit l'output maximum r√©alisable, alors que si $TE_i < 1$, il existe un √©cart entre l'output maximum et l'output effectivement observ√©.
:::

## SFA ~ RAPPELS (II) {.smaller}

On peut r√©-√©crire $TE_i$ sous la forme ${\displaystyle TE_{i}=\exp \left\{{-u_{i}}\right\}}$. D√®s lors, nous obtenons l'√©quation suivante :

:::{.fragment .fade-in}

$${\displaystyle y_{i}=f(x_{i};\beta )\cdot \exp \left\{{-u_{i}}\right\}\cdot \exp \left\{{v_{i}}\right\}}$$ 
:::

La SFA (`Stochastic Frontier Analysis`) est une m√©thode param√©trique : elle requiert une forme fonctionnelle pr√©cise et les termes d'erreur $\epsilon_i$ ont une distribution particuli√®re (compos√©e) :

- $v_i$ est une erreur al√©atoire $\Rightarrow$ variation inexpliqu√©e par les variables ind√©pendantes du mod√®le, avec $v_i \sim \mathcal{N}(0, \sigma^2_v)$.
- $u_i$ est un composant unilat√©ral qui peut √™tre choisi parmi plusieurs distributions et $u_i \geq 0$, puisqu'il est n√©cessaire d'avoir $TE_i ‚â§ 1$.

:::{.fragment .fade-in}
> *La sp√©cification de cette m√©thode permet d‚Äôestimer les scores de l‚Äôefficience technique de chaque firme (historiquement), ou produit, dans notre cas.*
:::

::: {.footer}
--- `Recherche`, R√©alisation, Restitution ---
:::

## SFA ~ RAPPELS (III) {.smaller}

:::: {.columns}

::: {.column width="60%"}
*<u>$^*$Exemple</u>* : 

![](imgs/stochastic_image.jpeg){width=95%}

$*$ Droits d'auteur : [Lutz Bornmann](https://www.researchgate.net/profile/Lutz-Bornmann)
:::

::: {.column width="40%"}
A partir de cette repr√©sentation on peut clairement distinguer les effets de $v_i$ (`noise`) et ceux de $u_i$ (`inefficiency`).

***

- $y_i^*=$ output maximum
- $\Leftrightarrow \ln y_i^* = \ln\left[f(x_i;\beta)\right] + v_i$
- $y_i =$ output observ√©
- $\Leftrightarrow \ln y_i = \ln y_i^* -u_i$
- $\Leftrightarrow \ln y_i = \ln\left[f(x_i;\beta)\right] + v_i -u_i$

:::{.fragment} 
$$\boxed{\ln y_i = \ln\left[f(x_i;\beta)\right] + \epsilon_i}$$
:::

:::

::::

::: {.footer}
--- `Recherche`, R√©alisation, Restitution ---
:::

:::{.notes}
L'objectif de cette slide est d'expliquer graphiquement la SFA.

- On inclue aussi une transformation logarithmique permettant de manipuler plus facilement le terme d'erreur.
:::

## SFA Cost Frontier (I) {.smaller}

$$
\begin{split}
\ln(price_i) = \beta_0 + \beta_1 storage_i + \beta_2 brand_i + \beta_3 ram_i\\
+ \beta_4 induction_i + \beta_5 screen\_size_i + \beta_6 screen\_type_i\\
+ \beta_7 made\_in_i + \beta_8 upgrade\_storage_i + \beta_{9} das\_limbs_i \\
+ \beta_{10} network_i + \beta_{11} ppi_i + v_i + u_i
\end{split}
$$


## SFA Cost Frontier (II) {.smaller}

mettre efficacit√© moyenne dans le tableau

```{r}

scf <- sfa(
    log(price) ~ storage + brand + ram + induction + screen_size + screen_type + made_in + upgrade_storage + das_limbs + network + ppi,
    data = df_phones,
    truncNorm = FALSE,
    ineffDecrease = FALSE
)

summary(scf)$mleParam |>
    data.frame() |>
    rownames_to_column(var = "Variables") |>
    janitor::clean_names() |>
    mutate(
        variables = case_when(
            variables == "brandGOOGLE" ~ "*brand* `(GOOGLE)`",
            variables == "brandHONOR" ~ "*brand* `(HONOR)`",
            variables == "brandMOTOROLA" ~ "*brand* `(MOTOROLA)`",
            variables == "brandOPPO" ~ "*brand* `(OPPO)`",
            variables == "brandSAMSUNG" ~ "*brand* `(SAMSUNG)`",
            variables == "brandSONY" ~ "*brand* `(SONY)`",
            variables == "brandXIAOMI" ~ "*brand* `(XIAOMI)`",
            variables == "inductionTRUE" ~ "*induction* `(True)`",
            variables == "screen_typeBords incurv√©s" ~ "*screen_type* `(Bords Incurv√©s)`",
            variables == "screen_typePlat" ~ "*screen_type* `(Plat)`",
            variables == "screen_typePliable" ~ "*screen_type* `(Pliable)`",
            variables == "made_inJapon" ~ "*made_in* `(Japon)`",
            variables == "made_inTha√Ølande" ~ "*made_in* `(Tha√Ølande)`",
            variables == "made_inVi√™t Nam" ~ "*made_in* `(Vi√™t Nam)`",
            variables == "upgrade_storageTRUE" ~ "*upgrade_storage* `(True)`",
            variables == "network5G" ~ "*network* `(5G)`",
            .default = as.character(glue::glue("*{variables}*"))
        )
    ) |>
    mutate(signif = makestars(pr_z)) |>
    gt() |>
    cols_hide(c(z_value, pr_z)) |>
    cols_label(
        variables = gt::md("**Variables**"),
        estimate = gt::md("**Coefficients**"),
        std_error = gt::md("**Ecart Type**"),
        signif = gt::md("**Significativit√©**")
    ) |>
    tab_header(
        title = md("R√©sultats de l'estimation pour le mod√®le **SFA**"),
        subtitle = md("*Variable d√©pendante* : `log(price)`")
    ) |>
    fmt_number(
        columns = c(estimate, std_error, pr_z),
        decimals = 3,
        drop_trailing_zeros = TRUE
    ) |>
    fmt_percent(
        columns = estimate,
        rows = variables %nin% c("*(Intercept)*","*sigmaSq*", "*gamma*"),
        pattern = "+{x}"
    ) |>
    fmt_percent(
        columns = estimate,
        rows = estimate < 0,
    ) |>
    data_color(
        columns = estimate,
        rows = estimate < 0,
        method = "numeric",
        palette = c("red", "orange"),
        apply_to = "text"
    ) |>
    data_color(
        columns = estimate,
        rows = estimate > 0 & variables %nin% c("*(Intercept)*","*sigmaSq*", "*gamma*"),
        method = "numeric",
        palette = c("lightgreen", "darkgreen"),
        apply_to = "text"
    ) |>
    fmt_markdown(c(variables,signif)) |>
    tab_options(
        table.background.color = "#222222",
        table.font.color = "white",
        table.font.size = 8,
    ) |>
    opt_interactive(page_size_default = 5, use_highlight = TRUE)
```

## SFA Cost Frontier (III) 

comparaison AIC

```{r}
logLik(loghedonic)
logLik(scf)
```

## R√©f√©rences
